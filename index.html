<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é—®é¢˜åˆ†æä¸ç­–ç•¥æ¨æ¼”ç³»ç»Ÿ - ä¸“ä¸šç‰ˆ</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        
        /* æ‰“å°æ ·å¼ä¼˜åŒ– */
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            .card { box-shadow: none !important; border: 1px solid #e5e7eb !important; }
            body { background-color: white !important; }
        }
        .print-only { display: none; }
        
        /* æ»šåŠ¨æ¡ç¾åŒ– */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

<div id="app" class="min-h-screen">
    <div v-if="!currentUser" class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm flex items-center justify-center z-50 no-print">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md border border-slate-200">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-slate-800">{{ isRegMode ? 'åˆ›å»ºè´¦å·' : 'æ¬¢è¿å›æ¥' }}</h2>
                <p class="text-slate-500 mt-2">è¯·ç™»å½•ä»¥ä¿å­˜æ‚¨çš„åˆ†æè®°å½•</p>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">ç”¨æˆ·å</label>
                    <input v-model="authForm.username" type="text" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">å¯†ç </label>
                    <input v-model="authForm.password" type="password" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition">
                </div>
                <button @click="handleAuth" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-lg transition transform active:scale-[0.98]">
                    {{ isRegMode ? 'æ³¨ å†Œ' : 'ç™» å½•' }}
                </button>
                <p @click="isRegMode = !isRegMode" class="text-center text-sm text-blue-600 cursor-pointer hover:underline">
                    {{ isRegMode ? 'å·²æœ‰è´¦å·ï¼Ÿç‚¹æ­¤ç™»å½•' : 'æ²¡æœ‰è´¦å·ï¼Ÿç‚¹æ­¤æ³¨å†Œæ–°ç”¨æˆ·' }}
                </p>
            </div>
        </div>
    </div>

    <nav class="bg-white border-b border-slate-200 sticky top-0 z-40 no-print">
        <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="bg-blue-600 text-white p-1.5 rounded-lg">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                </div>
                <span class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-indigo-600">ç­–ç•¥æ¨æ¼”ç³»ç»Ÿ</span>
            </div>
            <div class="flex items-center gap-4" v-if="currentUser">
                <span class="text-sm font-medium text-slate-600">ğŸ‘¤ {{ currentUser }}</span>
                <button @click="logout" class="text-xs text-slate-400 hover:text-red-500 underline transition">é€€å‡ºç™»å½•</button>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <aside class="lg:col-span-3 space-y-4 no-print">
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-4 bg-slate-50 border-b border-slate-200 flex justify-between items-center">
                        <h3 class="font-bold text-slate-700">å†å²æ¡£æ¡ˆ</h3>
                        <button @click="resetForm" class="text-blue-600 text-sm hover:font-bold">+ æ–°å»º</button>
                    </div>
                    <div class="divide-y divide-slate-100 max-h-[calc(100vh-250px)] overflow-y-auto">
                        <div v-for="item in history" :key="item.id" @click="loadRecord(item)"
                             class="p-4 hover:bg-blue-50 cursor-pointer transition group">
                            <p class="text-sm font-semibold text-slate-800 truncate group-hover:text-blue-600">{{ item.title || 'æ— æ ‡é¢˜è®°å½•' }}</p>
                            <p class="text-[10px] text-slate-400 mt-1">{{ item.time }}</p>
                        </div>
                        <div v-if="history.length === 0" class="p-8 text-center text-slate-400 text-sm italic">
                            æš‚æ— è®°å½•ï¼Œå¼€å§‹åˆ†æå§
                        </div>
                    </div>
                </div>
            </aside>

            <main class="lg:col-span-9 space-y-8">
                
                <section class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 transition hover:shadow-md">
                    <div class="flex items-center gap-2 mb-6">
                        <span class="w-1.5 h-6 bg-blue-600 rounded-full"></span>
                        <h2 class="text-lg font-bold">1. ç°çŠ¶å‰–æ</h2>
                    </div>
                    <div class="space-y-6">
                        <div>
                            <label class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">å®¢æˆ·å·²çŸ¥çš„é—®é¢˜</label>
                            <textarea v-model="form.known_problem" class="w-full p-4 bg-slate-50 border border-slate-100 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none min-h-[100px]" placeholder="è¯·è¯¦ç»†æè¿°ç›®å‰æœ€æ ¸å¿ƒçš„é—®é¢˜èŠ‚ç‚¹..."></textarea>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">äº‹æƒ…çš„èƒŒæ™¯ä¸é™åˆ¶</label>
                            <textarea v-model="form.background" class="w-full p-4 bg-slate-50 border border-slate-100 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none min-h-[100px]" placeholder="æ—¶é—´ã€åœ°ç‚¹ã€ç›¸å…³äººç‰©ã€å·²æœ‰æ¡ä»¶ã€é™åˆ¶å› ç´ ç­‰èƒŒæ™¯ä¿¡æ¯..."></textarea>
                        </div>
                    </div>
                </section>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <section class="bg-white p-6 rounded-2xl shadow-sm border-t-4 border-green-500 shadow-sm border-x border-b border-slate-200">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-lg font-bold text-green-700">ğŸš€ æ­£å‘æˆåŠŸè·¯å¾„</h2>
                            <div :class="['px-3 py-1 rounded-full text-sm font-bold', totalPos > 100 ? 'bg-red-100 text-red-600' : 'bg-green-100 text-green-600']">
                                æ€»æƒé‡: {{ totalPos }}%
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div v-for="i in 3" :key="'p'+i" class="flex gap-2 items-start bg-slate-50 p-3 rounded-lg border border-slate-100 transition focus-within:border-green-300">
                                <span class="text-slate-300 font-bold mt-2">0{{i}}</span>
                                <div class="flex-1 space-y-2">
                                    <textarea v-model="form.pos[i-1].desc" rows="2" class="w-full bg-transparent outline-none text-sm" placeholder="æ­£å‘ç­–ç•¥æè¿°..."></textarea>
                                    <div class="flex items-center gap-2 border-t border-slate-200 pt-2">
                                        <span class="text-[10px] text-slate-400 font-bold uppercase">æƒé‡å æ¯”</span>
                                        <input v-model.number="form.pos[i-1].weight" type="number" class="w-16 bg-white border border-slate-200 rounded text-center text-sm py-0.5">
                                        <span class="text-slate-400 text-xs">%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p v-if="totalPos > 100" class="mt-4 text-xs text-red-500 italic">âš  è­¦å‘Šï¼šæ­£å‘æƒé‡æ€»å’Œä¸å¯è¶…è¿‡ 100%</p>
                    </section>

                    <section class="bg-white p-6 rounded-2xl shadow-sm border-t-4 border-red-500 shadow-sm border-x border-b border-slate-200">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-lg font-bold text-red-700">ğŸ›¡ï¸ åå‘é£é™©è§„é¿</h2>
                            <div :class="['px-3 py-1 rounded-full text-sm font-bold', totalNeg > 100 ? 'bg-red-100 text-red-600' : 'bg-red-50 text-red-600']">
                                æ€»æƒé‡: {{ totalNeg }}%
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div v-for="i in 3" :key="'n'+i" class="flex gap-2 items-start bg-slate-50 p-3 rounded-lg border border-slate-100 transition focus-within:border-red-300">
                                <span class="text-slate-300 font-bold mt-2">0{{i}}</span>
                                <div class="flex-1 space-y-2">
                                    <textarea v-model="form.neg[i-1].desc" rows="2" class="w-full bg-transparent outline-none text-sm" placeholder="åå‘è§„é¿æªæ–½..."></textarea>
                                    <div class="flex items-center gap-2 border-t border-slate-200 pt-2">
                                        <span class="text-[10px] text-slate-400 font-bold uppercase">æƒé‡å æ¯”</span>
                                        <input v-model.number="form.neg[i-1].weight" type="number" class="w-16 bg-white border border-slate-200 rounded text-center text-sm py-0.5">
                                        <span class="text-slate-400 text-xs">%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p v-if="totalNeg > 100" class="mt-4 text-xs text-red-500 italic">âš  è­¦å‘Šï¼šåå‘æƒé‡æ€»å’Œä¸å¯è¶…è¿‡ 100%</p>
                    </section>
                </div>

                <section class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <div class="flex items-center gap-2 mb-6">
                        <span class="w-1.5 h-6 bg-purple-600 rounded-full"></span>
                        <h2 class="text-lg font-bold">3. è¡ŒåŠ¨é¡ºåºæ¨æ¼”</h2>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label class="text-sm font-semibold text-slate-600">ä»æ­£å‘å‡ºå‘çš„æ‰§è¡Œé€»è¾‘ï¼š</label>
                            <textarea v-model="form.seq_pos" class="w-full p-4 bg-slate-50 border border-slate-100 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none h-32" placeholder="åŸºäºæƒé‡ä¼˜å…ˆçº§ï¼Œç¬¬ä¸€æ­¥åšä»€ä¹ˆ..."></textarea>
                        </div>
                        <div class="space-y-2">
                            <label class="text-sm font-semibold text-slate-600">ä»åå‘å‡ºå‘çš„é˜²èŒƒé€»è¾‘ï¼š</label>
                            <textarea v-model="form.seq_neg" class="w-full p-4 bg-slate-50 border border-slate-100 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none h-32" placeholder="ä¸ºäº†æ­¢æŸï¼Œå¿…é¡»ä¼˜å…ˆç¡®ä¿ä»€ä¹ˆä¸å‘ç”Ÿ..."></textarea>
                        </div>
                    </div>
                </section>

                <div class="flex flex-wrap items-center gap-4 py-10 no-print">
                    <button @click="saveRecord" :disabled="totalPos > 100 || totalNeg > 100"
                            class="px-10 py-4 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 text-white rounded-xl font-bold shadow-xl shadow-blue-200 transition-all active:scale-95 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg>
                        ä¿å­˜æœ¬æ¬¡åˆ†æ
                    </button>
                    <button @click="copyReport" class="px-6 py-4 bg-white border border-slate-200 text-slate-600 rounded-xl font-bold hover:bg-slate-50 transition active:scale-95">
                        ä¸€é”®æ‹·è´æŠ¥å‘Š
                    </button>
                    <button @click="printReport" class="px-6 py-4 bg-white border border-slate-200 text-slate-600 rounded-xl font-bold hover:bg-slate-50 transition active:scale-95">
                        è‡ªåŠ¨ç”Ÿæˆæ‰“å°/PDF
                    </button>
                </div>
            </main>
        </div>
    </div>
    
    <div class="print-only p-10 bg-white min-h-screen text-slate-900">
        <h1 class="text-3xl font-bold text-center border-b-2 border-slate-900 pb-4 mb-8">é—®é¢˜åˆ†æä¸ç­–ç•¥æ¨æ¼”æŠ¥å‘Š</h1>
        <div class="space-y-8">
            <div class="grid grid-cols-2 text-sm text-slate-500 mb-10">
                <p>ğŸ‘¤ è´Ÿè´£äººï¼š{{ currentUser }}</p>
                <p class="text-right">ğŸ“… æ‰“å°æ—¥æœŸï¼š{{ new Date().toLocaleString() }}</p>
            </div>
            
            <div class="space-y-2">
                <h2 class="font-bold text-xl bg-slate-100 p-2">ä¸€ã€æ ¸å¿ƒé—®é¢˜ä¸èƒŒæ™¯</h2>
                <div class="p-2 whitespace-pre-wrap"><span class="font-bold">é—®é¢˜ç‚¹ï¼š</span>{{ form.known_problem }}</div>
                <div class="p-2 whitespace-pre-wrap"><span class="font-bold">èƒŒæ™¯ä¿¡æ¯ï¼š</span>{{ form.background }}</div>
            </div>

            <div class="grid grid-cols-2 gap-10">
                <div class="space-y-4">
                    <h2 class="font-bold text-lg text-green-700 border-b border-green-200 pb-2">ğŸš€ æ­£å‘æˆåŠŸè·¯å¾„ ({{totalPos}}%)</h2>
                    <div v-for="(m, i) in form.pos" class="text-sm">
                        <p v-if="m.desc" class="mb-2"><span class="font-bold">[{{m.weight}}%]</span> {{m.desc}}</p>
                    </div>
                </div>
                <div class="space-y-4">
                    <h2 class="font-bold text-lg text-red-700 border-b border-red-200 pb-2">ğŸ›¡ï¸ åå‘é£é™©è§„é¿ ({{totalNeg}}%)</h2>
                    <div v-for="(m, i) in form.neg" class="text-sm">
                        <p v-if="m.desc" class="mb-2"><span class="font-bold">[{{m.weight}}%]</span> {{m.desc}}</p>
                    </div>
                </div>
            </div>

            <div class="space-y-4">
                <h2 class="font-bold text-xl bg-slate-100 p-2">äºŒã€è¡ŒåŠ¨é¡ºåºå»ºè®®</h2>
                <div class="p-2"><span class="font-bold text-blue-700">ã€æ­£å‘æ‰§è¡Œã€‘ï¼š</span>{{ form.seq_pos }}</div>
                <div class="p-2"><span class="font-bold text-red-700">ã€åå‘é˜²èŒƒã€‘ï¼š</span>{{ form.seq_neg }}</div>
            </div>
        </div>
    </div>
</div>

<script>
    const { createApp, ref, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            // --- è´¦å·ç³»ç»Ÿ (LocalStorageç‰ˆ) ---
            const currentUser = ref(localStorage.getItem('current_user_name'));
            const isRegMode = ref(false);
            const authForm = ref({ username: '', password: '' });
            const history = ref([]);

            const handleAuth = () => {
                if (!authForm.value.username || !authForm.value.password) {
                    alert('è¯·è¾“å…¥å®Œæ•´ä¿¡æ¯'); return;
                }
                const users = JSON.parse(localStorage.getItem('users_db') || '{}');
                
                if (isRegMode.value) {
                    if (users[authForm.value.username]) { alert('ç”¨æˆ·å·²å­˜åœ¨'); return; }
                    users[authForm.value.username] = authForm.value.password;
                    localStorage.setItem('users_db', JSON.stringify(users));
                    alert('æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•');
                    isRegMode.value = false;
                } else {
                    if (users[authForm.value.username] === authForm.value.password) {
                        localStorage.setItem('current_user_name', authForm.value.username);
                        currentUser.value = authForm.value.username;
                        loadHistory();
                    } else { alert('è´¦å·æˆ–å¯†ç é”™è¯¯'); }
                }
            };

            const logout = () => {
                localStorage.removeItem('current_user_name');
                currentUser.value = null;
                location.reload();
            };

            // --- è¡¨å•ç³»ç»Ÿ ---
            const form = ref({
                known_problem: '',
                background: '',
                pos: [{desc:'',weight:0},{desc:'',weight:0},{desc:'',weight:0}],
                neg: [{desc:'',weight:0},{desc:'',weight:0},{desc:'',weight:0}],
                seq_pos: '',
                seq_neg: ''
            });

            const totalPos = computed(() => form.value.pos.reduce((s, i) => s + (Number(i.weight) || 0), 0));
            const totalNeg = computed(() => form.value.neg.reduce((s, i) => s + (Number(i.weight) || 0), 0));

            // --- è®°å½•å­˜å– ---
            const loadHistory = () => {
                if (!currentUser.value) return;
                const key = `history_${currentUser.value}`;
                history.value = JSON.parse(localStorage.getItem(key) || '[]');
            };

            const saveRecord = () => {
                if (!currentUser.value) { alert('ç™»å½•åæ‰èƒ½ä¿å­˜'); return; }
                const record = {
                    id: Date.now(),
                    title: form.value.known_problem.substring(0, 20) || 'æœªå‘½ååˆ†æ',
                    time: new Date().toLocaleString(),
                    data: JSON.parse(JSON.stringify(form.value))
                };
                const key = `history_${currentUser.value}`;
                const data = JSON.parse(localStorage.getItem(key) || '[]');
                data.unshift(record);
                localStorage.setItem(key, JSON.stringify(data));
                history.value = data;
                alert('è®°å½•å·²æˆåŠŸä¿å­˜');
            };

            const loadRecord = (item) => {
                form.value = JSON.parse(JSON.stringify(item.data));
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const resetForm = () => {
                form.value = {
                    known_problem: '', background: '',
                    pos: [{desc:'',weight:0},{desc:'',weight:0},{desc:'',weight:0}],
                    neg: [{desc:'',weight:0},{desc:'',weight:0},{desc:'',weight:0}],
                    seq_pos: '', seq_neg: ''
                };
            };

            // --- åŠŸèƒ½æ€§æ“ä½œ ---
            const copyReport = () => {
                let text = `ã€é—®é¢˜åˆ†æä¸æ¨æ¼”æŠ¥å‘Šã€‘\n\næ ¸å¿ƒé—®é¢˜ï¼š${form.value.known_problem}\nèƒŒæ™¯ä¿¡æ¯ï¼š${form.value.background}\n\n`;
                text += `ğŸš€ æ­£å‘ç­–ç•¥ (æ€»è®¡ ${totalPos.value}%)ï¼š\n` + form.value.pos.filter(i=>i.desc).map(i=>`- [${i.weight}%] ${i.desc}`).join('\n');
                text += `\n\nğŸ›¡ï¸ åå‘è§„é¿ (æ€»è®¡ ${totalNeg.value}%)ï¼š\n` + form.value.neg.filter(i=>i.desc).map(i=>`- [${i.weight}%] ${i.desc}`).join('\n');
                text += `\n\nğŸ”„ è¡ŒåŠ¨é¡ºåºæ¨æ¼”ï¼š\næ­£å‘ï¼š${form.value.seq_pos}\nåå‘ï¼š${form.value.seq_neg}`;
                
                navigator.clipboard.writeText(text).then(() => alert('å®Œæ•´æ–‡æœ¬å·²æ‹·è´è‡³å‰ªè´´æ¿ï¼Œå¯ç›´æ¥ç²˜è´´ã€‚'));
            };

            const printReport = () => { window.print(); };

            onMounted(loadHistory);

            return { currentUser, isRegMode, authForm, handleAuth, logout, form, totalPos, totalNeg, history, saveRecord, loadRecord, resetForm, copyReport, printReport };
        }
    }).mount('#app');
</script>
</body>
</html>
